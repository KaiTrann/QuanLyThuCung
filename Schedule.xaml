<Window x:Class="Nhóm_7.Schedule"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Quản lý Lịch hẹn &amp; Tiêm phòng"
        Height="720"
        Width="1000"
        MinWidth="860"
        MinHeight="600"
        WindowStartupLocation="CenterScreen"
        Background="#F3F6FB">

    <Window.Resources>

        <Style x:Key="Lbl" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,5"/>
        </Style>

        <Style x:Key="InputText" TargetType="TextBox">
            <Setter Property="Height" Value="32"/>
            <Setter Property="Padding" Value="10,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <Style x:Key="InputCombo" TargetType="ComboBox">
            <Setter Property="Height" Value="32"/>
            <Setter Property="Padding" Value="10,0,28,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <Style x:Key="InputDate" TargetType="DatePicker">
            <Setter Property="Height" Value="32"/>
        </Style>

        <Style x:Key="Btn" TargetType="Button">
            <Setter Property="Height" Value="32"/>
            <Setter Property="MinWidth" Value="90"/>
            <Setter Property="Margin" Value="0,0,10,0"/>
            <Setter Property="Padding" Value="14,0"/>
        </Style>

        <Style x:Key="Card" TargetType="Border">
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>

        <!-- Searchable Combo cho PET -->
        <Style x:Key="SearchPetCombo" TargetType="ComboBox" BasedOn="{StaticResource InputCombo}">
            <Setter Property="IsEditable" Value="True"/>
            <Setter Property="IsTextSearchEnabled" Value="True"/>
            <Setter Property="StaysOpenOnEdit" Value="True"/>
            <Setter Property="TextSearch.TextPath" Value="PetName"/>
            <Setter Property="DisplayMemberPath" Value="PetName"/>
            <Setter Property="SelectedValuePath" Value="PetId"/>
        </Style>

        <!-- Searchable Combo cho VACCINE -->
        <Style x:Key="SearchVaccineCombo" TargetType="ComboBox" BasedOn="{StaticResource InputCombo}">
            <Setter Property="IsEditable" Value="True"/>
            <Setter Property="IsTextSearchEnabled" Value="True"/>
            <Setter Property="StaysOpenOnEdit" Value="True"/>
            <Setter Property="TextSearch.TextPath" Value="VaccineName"/>
            <Setter Property="DisplayMemberPath" Value="VaccineName"/>
            <Setter Property="SelectedValuePath" Value="VaccineId"/>
        </Style>

    </Window.Resources>

    <Grid Margin="12">
        <Border Style="{StaticResource Card}">
            <TabControl>

                <!-- ================= TAB 1: LỊCH HẸN ================= -->
                <TabItem Header="Lịch hẹn">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- FORM -->
                        <Border Grid.Row="0" Style="{StaticResource Card}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="2*"/>
                                        <ColumnDefinition Width="1.3*"/>
                                        <ColumnDefinition Width="2.4*"/>
                                        <ColumnDefinition Width="1.6*"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                        <TextBlock Text="Thú cưng" Style="{StaticResource Lbl}"/>
                                        <ComboBox x:Name="cbPetAppointment" Style="{StaticResource SearchPetCombo}"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Margin="0,0,12,0">
                                        <TextBlock Text="Ngày hẹn" Style="{StaticResource Lbl}"/>
                                        <DatePicker x:Name="dpAppointmentDate" Style="{StaticResource InputDate}"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="2" Margin="0,0,12,0">
                                        <TextBlock Text="Lý do" Style="{StaticResource Lbl}"/>
                                        <TextBox x:Name="txtReason" Style="{StaticResource InputText}"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="3">
                                        <TextBlock Text="Trạng thái" Style="{StaticResource Lbl}"/>
                                        <ComboBox x:Name="cbStatus" Style="{StaticResource InputCombo}">
                                            <ComboBoxItem Content="Chờ xác nhận"/>
                                            <ComboBoxItem Content="Đã xác nhận"/>
                                            <ComboBoxItem Content="Hoàn thành"/>
                                            <ComboBoxItem Content="Đã hủy"/>
                                        </ComboBox>
                                    </StackPanel>
                                </Grid>

                                <!-- Nút tự xuống dòng khi thu nhỏ -->
                                <WrapPanel Grid.Row="1"
                                           Margin="0,10,0,0"
                                           HorizontalAlignment="Right">
                                    <Button Content="Thêm" Style="{StaticResource Btn}" Click="AddAppointment_Click"/>
                                    <Button Content="Sửa" Style="{StaticResource Btn}" Click="EditAppointment_Click"/>
                                    <Button Content="Xóa" Style="{StaticResource Btn}" Click="DeleteAppointment_Click"/>
                                </WrapPanel>
                            </Grid>
                        </Border>

                        <!-- SEARCH -->
                        <Border Grid.Row="1" Style="{StaticResource Card}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="3*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="Tìm thú cưng:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <ComboBox x:Name="cbSearchAppointment" Grid.Column="1" Style="{StaticResource SearchPetCombo}"/>

                                <Button Grid.Column="2" Content="Tìm" Style="{StaticResource Btn}" Click="SearchAppointment_Click"/>
                                <Button Grid.Column="3" Content="Tất cả" Style="{StaticResource Btn}" Click="ShowAllAppointment_Click"/>
                            </Grid>
                        </Border>

                        <!-- STATS -->
                        <Border Grid.Row="2" Style="{StaticResource Card}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="3*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="Chọn ngày:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <DatePicker x:Name="dpFilterDate" Grid.Column="1" Style="{StaticResource InputDate}"/>

                                <Button Grid.Column="2" Content="Thống kê" Style="{StaticResource Btn}" Click="CountByDate_Click"/>
                                <Button Grid.Column="3" Content="Hôm nay" Style="{StaticResource Btn}" Click="CountToday_Click"/>

                                <TextBlock x:Name="txtResultCount"
                                           Grid.Column="4"
                                           FontWeight="Bold"
                                           Foreground="#1E67C6"
                                           VerticalAlignment="Center"
                                           Margin="12,0,0,0"/>
                            </Grid>
                        </Border>

                        <!-- DATA -->
                        <Border Grid.Row="3" Style="{StaticResource Card}" Margin="0">
                            <DataGrid x:Name="dgAppointments"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      RowHeight="30"
                                      HeadersVisibility="Column"
                                      GridLinesVisibility="None">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Thú cưng" Binding="{Binding Pet}" Width="2*"/>
                                    <DataGridTextColumn Header="Ngày hẹn" Binding="{Binding Date}" Width="2*"/>
                                    <DataGridTextColumn Header="Lý do" Binding="{Binding Reason}" Width="3*"/>
                                    <DataGridTextColumn Header="Trạng thái" Binding="{Binding Status}" Width="2*"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </Border>

                    </Grid>
                </TabItem>

                <!-- ================= TAB 2: TIÊM PHÒNG ================= -->
                <TabItem Header="Tiêm phòng">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- FORM -->
                        <Border Grid.Row="0" Style="{StaticResource Card}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="2*"/>
                                        <ColumnDefinition Width="2.4*"/>
                                        <ColumnDefinition Width="1.3*"/>
                                        <ColumnDefinition Width="1.3*"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                        <TextBlock Text="Thú cưng" Style="{StaticResource Lbl}"/>
                                        <ComboBox x:Name="cbPetVaccine" Style="{StaticResource SearchPetCombo}"/>
                                    </StackPanel>

                                    <!-- ✅ VACCINE COMBO FROM DB -->
                                    <StackPanel Grid.Column="1" Margin="0,0,12,0">
                                        <TextBlock Text="Tên vắc-xin" Style="{StaticResource Lbl}"/>
                                        <ComboBox x:Name="cbVaccineName" Style="{StaticResource SearchVaccineCombo}"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="2" Margin="0,0,12,0">
                                        <TextBlock Text="Ngày tiêm" Style="{StaticResource Lbl}"/>
                                        <DatePicker x:Name="dpVaccineDate" Style="{StaticResource InputDate}"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="3">
                                        <TextBlock Text="Hạn tiếp theo" Style="{StaticResource Lbl}"/>
                                        <DatePicker x:Name="dpNextDueDate" Style="{StaticResource InputDate}"/>
                                    </StackPanel>
                                </Grid>

                                <!-- Nút tự xuống dòng khi thu nhỏ -->
                                <WrapPanel Grid.Row="1"
                                           Margin="0,10,0,0"
                                           HorizontalAlignment="Right">
                                    <Button Content="Thêm" Style="{StaticResource Btn}" Click="AddVaccine_Click"/>
                                    <Button Content="Sửa" Style="{StaticResource Btn}" Click="EditVaccine_Click"/>
                                    <Button Content="Xóa" Style="{StaticResource Btn}" Click="DeleteVaccine_Click"/>
                                </WrapPanel>
                            </Grid>
                        </Border>

                        <!-- SEARCH -->
                        <Border Grid.Row="1" Style="{StaticResource Card}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="3*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="Tìm thú cưng:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <ComboBox x:Name="cbSearchVaccine" Grid.Column="1" Style="{StaticResource SearchPetCombo}"/>

                                <Button Grid.Column="2" Content="Tìm" Style="{StaticResource Btn}" Click="SearchVaccine_Click"/>
                                <Button Grid.Column="3" Content="Tất cả" Style="{StaticResource Btn}" Click="ShowAllVaccine_Click"/>
                            </Grid>
                        </Border>

                        <!-- STATS -->
                        <Border Grid.Row="2" Style="{StaticResource Card}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="3*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="Chọn ngày tiêm:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <DatePicker x:Name="dpVaccineFilterDate" Grid.Column="1" Style="{StaticResource InputDate}"/>

                                <Button Grid.Column="2" Content="Thống kê" Style="{StaticResource Btn}" Click="CountVaccineByDate_Click"/>
                                <Button Grid.Column="3" Content="Hôm nay" Style="{StaticResource Btn}" Click="CountVaccineToday_Click"/>

                                <TextBlock x:Name="txtVaccineResult"
                                           Grid.Column="4"
                                           FontWeight="Bold"
                                           Foreground="#168E3A"
                                           VerticalAlignment="Center"
                                           Margin="12,0,0,0"/>
                            </Grid>
                        </Border>

                        <!-- DATA -->
                        <Border Grid.Row="3" Style="{StaticResource Card}" Margin="0">
                            <DataGrid x:Name="dgVaccines"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      RowHeight="30"
                                      HeadersVisibility="Column"
                                      GridLinesVisibility="None">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Thú cưng" Binding="{Binding Pet}" Width="2*"/>
                                    <DataGridTextColumn Header="Vắc-xin" Binding="{Binding VaccineName}" Width="3*"/>
                                    <DataGridTextColumn Header="Ngày tiêm" Binding="{Binding Date}" Width="2*"/>
                                    <DataGridTextColumn Header="Hạn tiếp theo" Binding="{Binding NextDueDate}" Width="2*"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </Border>

                    </Grid>
                </TabItem>

            </TabControl>
        </Border>
    </Grid>
</Window>